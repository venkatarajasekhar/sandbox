#!/bin/sh -x




# You need to specify the type, so the browser can render it when downloaded
# 6e1295ed6c29495e54cc05947f18c8af is the document you want to attach the file to
# 2-2739352689 is the revision of that document
# profile.jpg is the fiel to be attached
# profile.jpg is a JPEG file

printf "\nPUT OFFLINE ATTACHMENT (profile.jpg)\n"

curl -X PUT ${COUCH_URI}/employees/joeattach -H "Content-Type: application/json" -d @attach_01.json 
curl -X GET ${COUCH_URI}/employees/joeattach 

curl -vX PUT ${COUCH_URI}/employees/joeattach/profile.jpg?rev=1-5b8d8a614233a30625888c97c32b1778                      \
    --data-binary @profile.jpg                                              \
    -H "Content-Type: image/jpg" 

curl -X GET ${COUCH_URI}/employees/joeattach 

# Adding an attachment offline create a new document (new revision)
# {"_id":"joeattach","_rev":"2-5de164e05efaedf3bf437f41febb4b34","_attachments":{"profile.jpg":{"content_type":"image/jpg","revpos":2,"length":12356,"stub":true}}}


#Attached with the document
printf "\nPUT INLINE ATTACHMENT (foo.txt)\n"

curl -X PUT ${COUCH_URI}/employees/johnattach -H "Content-Type: application/json" -d @attach_02.json
curl -X PUT ${COUCH_URI}/employees/sallyattach -H "Content-Type: application/json" -d @attach_03.json

printf "\nGET INLINE ATTACHMENT (foo.txt)\n"
curl -X GET http://username:password@127.0.0.1:5984/employees/johnattach/foo.txt
curl -X GET http://username:password@127.0.0.1:5984/employees/sallyattach/foo.txt

echo



