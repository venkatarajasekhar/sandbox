
Q: On which port is apache working?
Default port is 80

Q: How to restart apache?
sudo apachectl restart

Q: Location of www files?
/var/www on ubuntu 12.04 LTS

Q: Home page for user account?
Directory /home/*/public_html

Q: File to open first?
If several files are present, starts with index.html, then try index.cgi. then ...
<IfModule mod_dir.c>
          DirectoryIndex index.html index.cgi index.pl index.php index.xhtml index.htm
</IfModule>
!!! To enable a php page, move the index.html to index.htm

Q: How to see how configuration file is parsed? 
/usr/local/apache2/bin/httpd -S 

#-----------------------------------------------------------------------
# VIRTUAL HOST

Q: What is a name-based virtual host?
Two websites have different server names, but whose files are hosted on the SAME machine, i.e. SAME IP and SAME port.
ex: host.domain.com and www.other_domain.org
1/ The hostname should route to the machine ( So the GET http requests get routed correctly !)
2/ On the server, hostname should resolve as localhost (to make apache happy)
3/ Apache needs to have a VirtualHost directive on desired port
    <VirtualHost *:80>
        ServerAdmin webmaster@domain.com
        DocumentRoot "/var/www/domain.com"
        ServerName domain.com
        ServerAlias www.domain.com
    </VirtualHost>
!!! The VirtualHost directive can contain configuration directives which are specific to that virtual host.

Q: How to create a virtual host?
cd /etc/apache2/sites-available/
cp default crowdsets.com
vi crowdsets.com
[...]
<VirtualHost *:80>
        ServerAdmin webmaster@crowdsets.com
        ServerName crowdsets.com
        ServerAlias www.crowdsets.com
        DocumentRoot /var/www/crowdsets/public
[...]
cat >> /etc/hosts <<EOT
127.0.0.1       www.crowdsets.com crowdsets.com
EOT

$ sudo a2ensite crowdsets
Enabling site crowdsets.
To activate the new configuration, you need to run:
  service apache2 reload
$ sudo service apache2 reload
 * Reloading web server config apache2  

Q: IP-based vitual hosts?
An IP address for each website

Q: More info?
More @ http://httpd.apache.org/docs/trunk/vhosts/

#-----------------------------------------------------------------------
# HTACCESS

Q: What are .htaccess files?
Located in the html directory, those files are used to set the configuration on a directory basis.
But the master configuration file should allow for this server / virtual host
For example, in a virtual host directive
        <Directory /var/www/crowdsets>                          # <-- Directory in question
                Options Indexes FollowSymLinks MultiViews       # <-- Default option for this directory
                AllowOverride All                               # <-- What can be done in .htaccess files
                Order allow,deny
                allow from all
        </Directory>

Q: What are Options?
Options configure what features are available in a particular directory
They can be seen in the server config, virtual host, directory, .htaccess
Most common options are:
ExecCGI             - executinon of CGI scripts using mod_cgi is permitted
Includes            - server side includes are permitted
Indexes             - turn on directory listing whenever a DirectoryIndex (index.html, etc) is not present
FollowSymLinks      - follow symbolic links
MultiViews          - allow substitutions of file extensions (i.e /mypage.php is also accessible with /mypage )
More @ http://httpd.apache.org/docs/trunk/mod/core.html#options

Q: + and - options?
When using + or - in front of options, it means that you are setting a delta
(options are inherited from parent directories) and not the absolute options.
<Directory "/web/docs">
  Options Indexes FollowSymLinks
</Directory>
<Directory "/web/docs/spec">
  Options +Includes -Indexes
</Directory>

Q: Other method of autnetication?
Alias /mantis /usr/share/mantis/www                         # <-- where all the mantis php files are located
<Directory /usr/share/mantis/www/admin>                     # <-- When any file under this dir is accessed, first pop up an authentication dialog 
        AuthType Basic                                      # ex: http://<yourhost>/mantis/admin/install.php
        AuthName "Restricted Admin mantis"                  # Comment on authentication dialog box
        AuthUserFile /etc/mantis/htaccess.dat               # htaccess file to use
        Require valid-user
</Directory>

Q: Can htaccess files be used for authentication and directory configuration?
Well, it can be used for authentication (user:<hashed password>)

#-----------------------------------------------------------------------
# ISSUES

Q: Google bots and Multiviews?
http://www.gerd-riesselmann.net/archives/2005/04/beware-of-apaches-multiviews




Q: log files?
/var/log/apache
- access.log
- other_vhost_access.log    - GET requests and replies
- error.log                 - error (i.e file not found, which file was being looked at, etc)

Q: Is mod_rewrite working?

Q: Is my .htaccess accessed?
Did you change the AllowOverride directive ?
did you reload the apache conf?
Put a typo in the htaccess, reload THE PAGE, check the error.log
[Wed Jul 03 18:58:32 2013] [alert] [client 98.248.37.253] /var/www/crowdsets/public/.htaccess: Invalid command 'RewriteEngine', perhaps misspelled or defined by a module not included in the server configuration
!!! Because .htaccess files are read on every request, changes made in them take effect immeditely

i

#-----------------------------------------------------------------------
# APACHE MODULES

Q: What are modules?
Apache2 web server boasts of extensible features which are realized by the 
notion of pluggable modules. When building Apache2, you compile a set of 
modules you think are necessary, into it. 

Q: Default module list?
actions.load
alias.load
asis.load
auth_basic.load
auth_digest.load
authn_alias.load
authn_anon.load
authn_dbd.load
authn_dbm.load
authn_default.load
authn_file.load
authnz_ldap.load
authz_dbm.load
authz_default.load
authz_groupfile.load
authz_host.load
authz_owner.load
authz_user.load
autoindex.load
cache.load
cern_meta.load
cgid.load
cgi.load
charset_lite.load
dav_fs.load
dav.load
dav_lock.load
dbd.load
deflate.load
dir.load
disk_cache.load
dump_io.load
env.load
expires.load
ext_filter.load
file_cache.load
filter.load
headers.load
ident.load
imagemap.load
include.load
info.load
ldap.load
log_forensic.load
mem_cache.load
mime.load
mime_magic.load
negotiation.load
php5.load
proxy_ajp.load
proxy_balancer.load
proxy_connect.load
proxy_ftp.load
reqtimeout.load
rewrite.load
setenvif.load
speling.load
ssl.load
status.load
substitute.load
suexec.load
unique_id.load
userdir.load
usertrack.load
version.load
vhost_alias.load


#-----------------------------------------------------------------------
# MOD-WRITE

Q: What is mod-write?
One such module is called mod_rewrite which is responsible for rewriting 
website URLs at the server side. For example, when user asks for 
http://myserver.com/my_category/my_post.html, the requested URL 
is translated by mod_rewrite to 
http://myserver.com/post.php?category=100&post=200, 
which is then handled (processed) by the web server.

Q: Why use mod-rewrite?
Webmasters generally use mod_rewrite to improve user-friendliness 
and search engine friendliness of web sites by letting mod_rewrite 
expose more memorable and crawlable URLs to the world. 
Also, it can help hide any sensitive information such as query strings 
from URL requests, and hence can enhance website safety.

Q: How to check if mod_rewrite is enabled?
ls -al /etc/apache/mods-enabled/*
You should see
lrwxrwxrwx 1 root root 30 Dec  9 23:10   /etc/apache2/mods-enabled/rewrite.load -> ../mods-available/rewrite.load

Q: How to enable mod_write?
* cat /etc/apache2/mods-available/rewrite.load
* sudo a2enmod rewrite
    This command create a symbolic link in /etc/pache2/mods-enabled
* sudo service apache2 restart
!!! On ubunbu, mod-write is installed but not enabled by default
