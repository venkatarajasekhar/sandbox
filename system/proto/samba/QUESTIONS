Q: How to install?
apt-get install samba

Q: Configuration file ?
/etc/samba/smb.conf

Q: what is SMB and CIFS?
Microsoft has also contributed by offering its definition of the SMB protocol 
to the Internet Engineering Task Force (IETF) in 1996 as the 
Common Internet File System (CIFS). Although we prefer to use the term "SMB", 
this protocol being referred to as "CIFS." This is especially true on Microsoft's web site.

Q: Daemons?
smbd
A daemon that handles file and printer sharing and provides authentication and authorization for SMB clients.
nmbd
A daemon that supports NetBIOS Name Service and WINS, which is Microsoft's implementation of a NetBIOS Name Server (NBNS). It also assists with network browsing.

Q: Configure a share?
Let's assume that
sudo mkdir -p /srv/samba/share
sudo chown nobody.nogroup /srv/samba/share/         # <-- Check ownership !
In configuration file in [global] section
workgroup = LYNCEAN
...
security = user                         # Users to to have an account on the server (same UID, same password)
[share]                                 # Name of share (is share!)
    comment = Ubuntu File Server Share  # Comment in windows explorer
    path = /srv/samba/share             # Path to share on server
    browsable = yes                     # Can be navigated in windows explorer
    guest ok = no                       # Guest access not ok (login is required!)
    read only = no                      # Read only share?
    create mask = 0755                  # Mask for creation of files

Restart daemon to enable
sudo service smbd restart               # Required each time /etc/samba/smd.conf is changed
sudo service nmbd restart 

Q: How to access the newly created share?
useradd -M emayssat -u 516 -g 100       # <-- NO! You need a smbpasswd not a syste, password!
passwd emayssat                         
On the windows machine, go to IP and enter username and password
You should be able to browse the share
Run --> control userpasswords2

Q: How to create a smbuser?
Create a unix user
# useradd -u 516 -g 100 -d /export/users/emayssat -M emayssat
Create a smb passwd
# smbpasswd -a emayssat
!!! No unix password is required for simple share access


Q: How to set a smbuser password?
../bin/smbpasswd -a emayssat    <-- to add a user and set passwd
../bin/smbpasswd emayssat       <-- to change the passwd of an existing user
smbpasswd -e emayssat           <-- to enable user

smbpasswd will change the passwd file that is specified in the samba configuration.
!!! it may not be the one you think it is.

Q: Content of smbpassword file?
root@footee:/export/it/samba/etc# more smbpasswd 
root:0:CD8D9541439194FEE72C57EF50F76A05:96F5F0FB3FD850C908BB7DB90388FA1F:[U          ]:LCT-40131C98:
jrifkin:504:2E925C53E05183A9F500944B53168930:4B9FBD71B431F252E6F7E9FD654DCCE4:[U          ]:LCT-4511738C:

Q: what is the difference between the smbpasswd and /etc/passwd file?
An entry in /etc/passwd file must exist for every single user.
The smbpasswd is used to manage access to the samba shares 
The password in smbpasswd is used for samba shares only.
the password in /etc/passwd is used for ssh, etc


#-----------------------------------------------------------------------
# CONFIGURATION 

Q: Sample directives?
admin users         - string (list of usernames) = Users who can perform operations as root (id root on server)
valid users         - string (list of usernames) = Users who can connect to a share (also @group is ok)
invalid users       - string (list of usernames) = Users who will be denied access to a share
read list           - string (list of usernames) = Users who have read-only access to a writable share
write list          - string (list of usernames) = Users who have read/write access to a read-only share
max connections     - numeric = Maximum number of connections for a share at a given time
guest only          - Boolean = If yes, allows only guest access
guest account       - string (name of account) = Unix account that will be used for guest access (nobody)

Q: Normal share?
[business_plan]
comment = Share for grants and business plan
path = /export/business_plan
browsable = yes                                 # <-- Can be seen?
guest ok = no 
read only = yes
write list = cruth rruth rloewen                # <-- Who has write access in the read only share
create mask = 0755

Q: Guest access?
[sales]
path = /home/sales
comment = Sedona Real Estate Sales Data
writable = yes
guest ok = yes
guest account = ftp
guest only = yes

Q: How do home share works?
The [homes] share is a special section of the Samba configuration file. 
If a user attempts to connect to an ordinary share that doesn't appear in the smb.conf file 
(such as specifying it with a UNC in Windows Explorer), Samba will search for a [homes] share. 
If one exists, the incoming share name is assumed to be a username and is queried as such in 
the password database ( /etc/passwd or equivalent) file of the Samba server. If it appears, 
Samba assumes the client is a Unix user trying to connect to his home directory.

Q: Illustration of access to home share?
As an illustration, let's assume that sofia is attempting to connect to a share called [sofia] 
on the Samba server. There is no share by that name in the configuration file, but a 
[homes] share exists and user sofia is present in the password database, so Samba takes 
the following steps:
1. Samba creates a new disk share called [sofia] with the path specified in the [homes] section. 
    If no path option is specified in [homes], Samba initializes it to her home directory.
2. Samba initializes the new share's options from the defaults in [globals], 
    as well as any overriding options in [homes] with the exception of browsable.
3. Samba connects sofia's client to that share.

Q: [homes] and browsable?
The meaning of the browsable configuration option is different from other shares; 
it indicates only that a [homes] section won't show up in the local browse list, 
not that the [alice] share won't. When the [alice] section is created (after the 
initial connection), it will use the browsable value from the [globals] section 
for that share, not the value from [homes].
i.e. in [homes] browsable should be set to no, otherwise a share 'home' is visible (and not accessible)

Q: What if I want to see all the home directories?
[users]
browsable = yes
writable = yes
!!! Access rights are controlled by the unix ACL (on files and dirs)

Q: How to make the home directory appear?
The home directory appears AUTOMATICALLY when you browse the CIFS server
!!! If you don't want to be prompted for a password, the smbpasswd and the windows password need to be the same

#-----------------------------------------------------------------------
# TROUBLESHOOT

Q: 
smbstatus
#-----------------------------------------------------------------------
# WINDOWS

Q: What is a domain controller?
A domain controller in a Windows NT domain functions much like a Network Information Service (NIS)
 server in a Unix network, maintaining a domain-wide database of user and group information, 
as well as performing related services. The responsibilities of a domain controller 
are mainly centered around security, including authentication, the process of granting 
or denying a user access to the resources of the domain. This is typically done through 
the use of a username and password. The service that maintains the database on the 
domain controllers is called the Security Account Manager (SAM).



